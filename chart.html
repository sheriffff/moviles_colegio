<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,700;1,9..40,400&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
<style>

  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'DM Sans', 'Inter', system-ui, -apple-system, sans-serif;
    background: #ffffff;
    color: #333333;
    overflow-x: hidden;
  }

  .toggle-bar {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(255,255,255,0.92);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-bottom: 1px solid #eee;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 14px 20px;
  }
  .toggle-bar-title {
    font-size: 28px;
    font-weight: 700;
    color: #333333;
    letter-spacing: -0.3px;
  }
  .toggle-bar-desc {
    font-size: 15px;
    font-weight: 400;
    color: #888888;
    margin-top: -4px;
  }
  .toggle-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 12px;
  }
  .toggle-group {
    display: flex;
    gap: 4px;
    background: #f7f7f7;
    border-radius: 12px;
    padding: 5px;
  }
  .toggle-center {
    display: flex;
    flex-direction: column;
    gap: 4px;
    background: #f7f7f7;
    border-radius: 12px;
    padding: 5px;
  }
  .toggle-btn {
    border: none;
    background: transparent;
    font-family: 'DM Sans', 'Inter', system-ui, -apple-system, sans-serif;
    font-size: 15px;
    font-weight: 500;
    color: #888888;
    padding: 10px 24px;
    border-radius: 9px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 9px;
  }
  .toggle-btn:hover {
    color: #4a4a4a;
  }
  .toggle-btn.active {
    background: #ffffff;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    color: #333333;
    font-weight: 600;
  }
  .toggle-btn[data-filter="Andel"].active {
    background: rgba(6,7,134,0.09);
    color: #060786;
    box-shadow: 0 1px 4px rgba(6,7,134,0.15);
  }
  .toggle-btn[data-filter="Fuenllana"].active {
    background: rgba(198,0,39,0.09);
    color: #c60027;
    box-shadow: 0 1px 4px rgba(198,0,39,0.15);
  }
  .toggle-dot {
    width: 11px;
    height: 11px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .toggle-logo {
    height: 72px;
    object-fit: contain;
    opacity: 0.7;
    transition: opacity 0.2s;
  }
  .toggle-logo:hover {
    opacity: 1;
  }

  .color-legend {
    display: flex;
    gap: 20px;
    margin-top: 4px;
  }
  .color-legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 14px;
    color: #4a4a4a;
  }
  .color-legend-swatch {
    width: 14px;
    height: 14px;
    border-radius: 4px;
    flex-shrink: 0;
  }

  .page-content {
    max-width: 940px;
    margin: 0 auto;
    padding: 40px 20px 80px;
  }

  .page-header {
    text-align: center;
    margin-bottom: 56px;
  }

  .section-header {
    margin-top: 64px;
    margin-bottom: 0;
    padding: 16px 0;
    border-bottom: 2px solid #f0f0f0;
    cursor: pointer;
    user-select: none;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: border-color 0.2s;
  }
  .section-header:hover {
    border-bottom-color: #ccc;
  }
  .section-header:first-child {
    margin-top: 0;
  }
  .section-info {
  }
  .section-number {
    font-size: 13px;
    font-weight: 600;
    color: #888888;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 6px;
  }
  .section-name {
    font-size: 32px;
    font-weight: 700;
    color: #333333;
    line-height: 1.2;
  }
  .section-arrow {
    font-size: 28px;
    font-weight: 300;
    color: #888888;
    transition: transform 0.3s ease;
    flex-shrink: 0;
    margin-left: 16px;
  }
  .section-header.expanded .section-arrow {
    transform: rotate(90deg);
  }
  .section-content {
    display: none;
    padding-top: 40px;
        transition: opacity 0.25s ease;
  }
  .section-content.expanded {
    display: block;
  }

  .chart-section {
    position: relative;
    margin-bottom: 56px;
  }
  .chart-main {
  }
  .chart-code {
    font-size: 13px;
    font-weight: 600;
    color: #888888;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
  }
  .chart-title {
    font-size: 28px;
    font-weight: 700;
    color: #333333;
    line-height: 1.3;
    margin-bottom: 6px;
  }
  .chart-subtitle {
    font-size: 18px;
    font-weight: 400;
    color: #4a4a4a;
    line-height: 1.4;
    margin-bottom: 24px;
  }
  .chart-container {
    width: 100%;
    height: 500px;
  }
  .chart-footnote {
    font-size: 11px;
    color: #888888;
    margin-top: 16px;
    line-height: 1.5;
  }
  .chart-comment {
    position: absolute;
    left: -280px;
    top: 50%;
    transform: translateY(-50%);
    width: 260px;
    font-size: 22px;
    color: #2a9d8f;
    line-height: 1.4;
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .chart-comment p {
    margin: 0;
  }

  .chart-insight {
    position: absolute;
    right: -240px;
    top: 50%;
    transform: translateY(-50%) translateX(12px);
    width: 210px;
    text-align: center;
    opacity: 0;
    transition: all 0.4s ease;
    pointer-events: none;
  }
  .chart-insight.visible {
    opacity: 1;
    transform: translateY(-50%) translateX(0);
    pointer-events: auto;
  }
  .insight-block {
    margin-bottom: 18px;
  }
  .insight-block:last-child {
    margin-bottom: 0;
  }
  .insight-number {
    font-size: 46px;
    font-weight: 700;
    line-height: 1;
    margin-bottom: 8px;
  }
  .insight-label {
    font-size: 14px;
    color: #4a4a4a;
    line-height: 1.4;
  }

  .coming-soon {
    margin-top: 80px;
    padding-top: 48px;
    border-top: 2px solid #f0f0f0;
  }
  .coming-soon-title {
    font-size: 36px;
    font-weight: 700;
    color: #333333;
    margin-bottom: 4px;
  }
  .coming-soon-subtitle {
    font-size: 16px;
    color: #888888;
    margin-bottom: 36px;
  }
  .coming-section {
    margin-bottom: 28px;
  }
  .coming-section-name {
    font-size: 18px;
    font-weight: 700;
    color: #333333;
    margin-bottom: 8px;
  }
  .coming-section ul {
    list-style: none;
    padding-left: 0;
  }
  .coming-section li {
    font-size: 15px;
    color: #4a4a4a;
    padding: 4px 0 4px 20px;
    position: relative;
    line-height: 1.5;
  }
  .coming-section li::before {
    content: '·';
    position: absolute;
    left: 4px;
    color: #888888;
    font-weight: 700;
    font-size: 20px;
    line-height: 1.3;
  }

  #lock-screen {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: #ffffff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
  }
  #lock-screen.hidden { display: none; }
  #lock-screen h2 {
    font-size: 28px;
    font-weight: 700;
    color: #333333;
  }
  #lock-screen input {
    font-family: 'DM Sans', 'Inter', system-ui, -apple-system, sans-serif;
    font-size: 18px;
    padding: 12px 20px;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    outline: none;
    width: 280px;
    text-align: center;
    transition: border-color 0.2s;
  }
  #lock-screen input:focus {
    border-color: #2a9d8f;
  }
  #lock-screen input.error {
    border-color: #c60027;
    animation: shake 0.4s ease;
  }
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-8px); }
    75% { transform: translateX(8px); }
  }
  .lock-btn {
    font-family: 'DM Sans', 'Inter', system-ui, -apple-system, sans-serif;
    font-size: 16px;
    padding: 10px 36px;
    border: none;
    border-radius: 10px;
    background: #2a9d8f;
    color: #fff;
    cursor: pointer;
    transition: opacity 0.2s;
  }
  .lock-btn:hover {
    opacity: 0.85;
  }

</style>
</head>
<body>

<div class="toggle-bar">
  <div class="toggle-controls">
    <div class="toggle-group">
      <button class="toggle-btn" data-filter="Andel" onclick="setFilter('Andel')">
        <span class="toggle-dot" style="background: #060786;"></span>
        Andel
      </button>
    </div>
    <div class="toggle-center">
      <button class="toggle-btn active" data-filter="todos" onclick="setFilter('todos')">
        <span class="toggle-dot" style="background: #2a9d8f;"></span>
        General
      </button>
      <button class="toggle-btn" data-filter="ambos" onclick="setFilter('ambos')">
        <span class="toggle-dot" style="background: linear-gradient(135deg, #060786 50%, #c60027 50%);"></span>
        Comparar
      </button>
    </div>
    <div class="toggle-group">
      <button class="toggle-btn" data-filter="Fuenllana" onclick="setFilter('Fuenllana')">
        <span class="toggle-dot" style="background: #c60027;"></span>
        Fuenllana
      </button>
    </div>
  </div>
</div>

<div class="page-content">
  <section class="chart-section">
    <div class="chart-main">
      <div class="chart-title">FOMO y agobio por 'visto' afectan a casi la mitad del alumnado</div>
      <div class="chart-subtitle">Porcentaje de alumnado afectado por cada indicador de presión social, por curso</div>
      <div class="chart-container" id="chart" style="height:340px"></div>
      
    </div>
  </section>
</div>

<script>
  var allCharts = [];
  var allOriginals = [];
  (function() {
      var el = document.getElementById('chart');
      var chart = echarts.init(el, null, { renderer: 'svg' });
      var opt = {
  "tooltip": {
    "formatter": function(p) {  var grupos = ["1-4 Primaria", "5-6 Primaria", "1-2 ESO", "3-4 ESO", "Bachillerato"];  var indics = ["FOMO", "Comparación social", "Agobio por 'visto'", "Likes"];  return '<b>' + indics[p.value[1]] + '</b><br/>' + grupos[p.value[0]] + ': <b>' + p.value[2] + '%</b> afectados';},
    "backgroundColor": "rgba(255,255,255,0.96)",
    "borderColor": "#eee",
    "borderWidth": 1,
    "textStyle": {
      "fontFamily": "'DM Sans', 'Inter', system-ui, -apple-system, sans-serif",
      "color": "#333333",
      "fontSize": 13
    }
  },
  "legend": {
    "show": false,
    "selected": {
      "Todos — Presión": true,
      "Andel — Presión": false,
      "Fuenllana — Presión": false
    }
  },
  "grid": [
    {
      "left": "5%",
      "right": "3%",
      "top": 20,
      "bottom": 20,
      "containLabel": true
    }
  ],
  "xAxis": [
    {
      "type": "category",
      "data": [
        "1-4 Primaria",
        "5-6 Primaria",
        "1-2 ESO",
        "3-4 ESO",
        "Bachillerato"
      ],
      "gridIndex": 0,
      "position": "bottom",
      "axisLabel": {
        "fontFamily": "'DM Sans', 'Inter', system-ui, -apple-system, sans-serif",
        "fontSize": 12,
        "color": "#4a4a4a"
      },
      "axisLine": {
        "show": false
      },
      "axisTick": {
        "show": false
      },
      "splitArea": {
        "show": false
      }
    }
  ],
  "yAxis": [
    {
      "type": "category",
      "data": [
        "FOMO",
        "Comparación social",
        "Agobio por 'visto'",
        "Likes"
      ],
      "gridIndex": 0,
      "inverse": true,
      "axisLabel": {
        "fontFamily": "'DM Sans', 'Inter', system-ui, -apple-system, sans-serif",
        "fontSize": 12,
        "color": "#4a4a4a"
      },
      "axisLine": {
        "show": false
      },
      "axisTick": {
        "show": false
      },
      "splitArea": {
        "show": false
      }
    }
  ],
  "visualMap": [
    {
      "min": 0,
      "max": 69,
      "calculable": false,
      "show": false,
      "inRange": {
        "color": [
          "#d4edda",
          "#e8963e",
          "#e76f51"
        ]
      },
      "seriesIndex": [
        0
      ]
    },
    {
      "min": 0,
      "max": 69,
      "calculable": false,
      "show": false,
      "inRange": {
        "color": [
          "#d4edda",
          "#e8963e",
          "#e76f51"
        ]
      },
      "seriesIndex": [
        1
      ]
    },
    {
      "min": 0,
      "max": 69,
      "calculable": false,
      "show": false,
      "inRange": {
        "color": [
          "#d4edda",
          "#e8963e",
          "#e76f51"
        ]
      },
      "seriesIndex": [
        2
      ]
    }
  ],
  "series": [
    {
      "name": "Todos — Presión",
      "type": "heatmap",
      "xAxisIndex": 0,
      "yAxisIndex": 0,
      "data": [
        [
          0,
          0,
          25.6
        ],
        [
          0,
          1,
          48.7
        ],
        [
          0,
          2,
          38.5
        ],
        [
          0,
          3,
          30.8
        ],
        [
          1,
          0,
          18.4
        ],
        [
          1,
          1,
          32.9
        ],
        [
          1,
          2,
          31.6
        ],
        [
          1,
          3,
          7.9
        ],
        [
          2,
          0,
          35.2
        ],
        [
          2,
          1,
          28.5
        ],
        [
          2,
          2,
          41.8
        ],
        [
          2,
          3,
          9.1
        ],
        [
          3,
          0,
          54.5
        ],
        [
          3,
          1,
          39.5
        ],
        [
          3,
          2,
          55.6
        ],
        [
          3,
          3,
          21.1
        ],
        [
          4,
          0,
          56.4
        ],
        [
          4,
          1,
          31.8
        ],
        [
          4,
          2,
          49.0
        ],
        [
          4,
          3,
          14.4
        ]
      ],
      "label": {
        "show": true,
        "formatter": function(p) { return p.value[2] > 0 ? p.value[2] + '%' : ''; },
        "fontSize": 13,
        "fontWeight": 600,
        "fontFamily": "'DM Sans', 'Inter', system-ui, -apple-system, sans-serif"
      },
      "itemStyle": {
        "borderColor": "#ffffff",
        "borderWidth": 3,
        "borderRadius": 6
      },
      "emphasis": {
        "itemStyle": {
          "borderColor": "#333",
          "borderWidth": 2
        }
      }
    },
    {
      "name": "Andel — Presión",
      "type": "heatmap",
      "xAxisIndex": 0,
      "yAxisIndex": 0,
      "data": [
        [
          0,
          0,
          31.8
        ],
        [
          0,
          1,
          54.5
        ],
        [
          0,
          2,
          45.5
        ],
        [
          0,
          3,
          45.5
        ],
        [
          1,
          0,
          10.0
        ],
        [
          1,
          1,
          35.0
        ],
        [
          1,
          2,
          30.0
        ],
        [
          1,
          3,
          10.0
        ],
        [
          2,
          0,
          26.5
        ],
        [
          2,
          1,
          25.3
        ],
        [
          2,
          2,
          36.1
        ],
        [
          2,
          3,
          14.5
        ],
        [
          3,
          0,
          37.7
        ],
        [
          3,
          1,
          28.9
        ],
        [
          3,
          2,
          43.0
        ],
        [
          3,
          3,
          20.2
        ],
        [
          4,
          0,
          42.7
        ],
        [
          4,
          1,
          22.9
        ],
        [
          4,
          2,
          41.7
        ],
        [
          4,
          3,
          14.6
        ]
      ],
      "label": {
        "show": true,
        "formatter": function(p) { return p.value[2] > 0 ? p.value[2] + '%' : ''; },
        "fontSize": 13,
        "fontWeight": 600,
        "fontFamily": "'DM Sans', 'Inter', system-ui, -apple-system, sans-serif"
      },
      "itemStyle": {
        "borderColor": "#ffffff",
        "borderWidth": 3,
        "borderRadius": 6
      },
      "emphasis": {
        "itemStyle": {
          "borderColor": "#333",
          "borderWidth": 2
        }
      }
    },
    {
      "name": "Fuenllana — Presión",
      "type": "heatmap",
      "xAxisIndex": 0,
      "yAxisIndex": 0,
      "data": [
        [
          0,
          0,
          17.6
        ],
        [
          0,
          1,
          41.2
        ],
        [
          0,
          2,
          29.4
        ],
        [
          0,
          3,
          11.8
        ],
        [
          1,
          0,
          27.8
        ],
        [
          1,
          1,
          30.6
        ],
        [
          1,
          2,
          33.3
        ],
        [
          1,
          3,
          5.6
        ],
        [
          2,
          0,
          43.9
        ],
        [
          2,
          1,
          31.7
        ],
        [
          2,
          2,
          47.6
        ],
        [
          2,
          3,
          3.7
        ],
        [
          3,
          0,
          66.3
        ],
        [
          3,
          1,
          46.9
        ],
        [
          3,
          2,
          64.4
        ],
        [
          3,
          3,
          21.7
        ],
        [
          4,
          0,
          68.9
        ],
        [
          4,
          1,
          40.0
        ],
        [
          4,
          2,
          55.7
        ],
        [
          4,
          3,
          14.2
        ]
      ],
      "label": {
        "show": true,
        "formatter": function(p) { return p.value[2] > 0 ? p.value[2] + '%' : ''; },
        "fontSize": 13,
        "fontWeight": 600,
        "fontFamily": "'DM Sans', 'Inter', system-ui, -apple-system, sans-serif"
      },
      "itemStyle": {
        "borderColor": "#ffffff",
        "borderWidth": 3,
        "borderRadius": 6
      },
      "emphasis": {
        "itemStyle": {
          "borderColor": "#333",
          "borderWidth": 2
        }
      }
    }
  ],
  "animationDuration": 800,
  "animationEasing": "cubicOut"
};
      allOriginals.push(JSON.parse(JSON.stringify(opt)));
      chart.setOption(opt);
      allCharts.push(chart);
      chart._el = el;
      window.addEventListener('resize', function() { chart.resize(); });
      chart._howCompare = 'sideBySide';
      chart._compareOpt = {"tooltip": {"formatter": function(p) {  var grupos = ["1-4 Primaria", "5-6 Primaria", "1-2 ESO", "3-4 ESO", "Bachillerato"];  var indics = ["FOMO", "Comparación social", "Agobio por 'visto'", "Likes"];  return '<b>' + indics[p.value[1]] + '</b><br/>' + grupos[p.value[0]] + ': <b>' + p.value[2] + '%</b> afectados';}, "backgroundColor": "rgba(255,255,255,0.96)", "borderColor": "#eee", "borderWidth": 1, "textStyle": {"fontFamily": "'DM Sans', 'Inter', system-ui, -apple-system, sans-serif", "color": "#333333", "fontSize": 13}}, "legend": {"show": false}, "grid": [{"left": "5%", "right": "52%", "top": 50, "bottom": 20, "containLabel": true}, {"left": "52%", "right": "3%", "top": 50, "bottom": 20, "containLabel": true}], "graphic": [{"type": "text", "left": "20%", "top": 14, "style": {"text": "Andel", "fontFamily": "'DM Sans', 'Inter', system-ui, -apple-system, sans-serif", "fontSize": 16, "fontWeight": 700, "fill": "#060786"}}, {"type": "text", "left": "68%", "top": 14, "style": {"text": "Fuenllana", "fontFamily": "'DM Sans', 'Inter', system-ui, -apple-system, sans-serif", "fontSize": 16, "fontWeight": 700, "fill": "#c60027"}}], "xAxis": [{"type": "category", "data": ["1-4 Primaria", "5-6 Primaria", "1-2 ESO", "3-4 ESO", "Bachillerato"], "gridIndex": 0, "position": "bottom", "axisLabel": {"fontFamily": "'DM Sans', 'Inter', system-ui, -apple-system, sans-serif", "fontSize": 12, "color": "#4a4a4a"}, "axisLine": {"show": false}, "axisTick": {"show": false}}, {"type": "category", "data": ["1-4 Primaria", "5-6 Primaria", "1-2 ESO", "3-4 ESO", "Bachillerato"], "gridIndex": 1, "position": "bottom", "axisLabel": {"fontFamily": "'DM Sans', 'Inter', system-ui, -apple-system, sans-serif", "fontSize": 12, "color": "#4a4a4a"}, "axisLine": {"show": false}, "axisTick": {"show": false}}], "yAxis": [{"type": "category", "data": ["FOMO", "Comparación social", "Agobio por 'visto'", "Likes"], "gridIndex": 0, "inverse": true, "axisLabel": {"fontFamily": "'DM Sans', 'Inter', system-ui, -apple-system, sans-serif", "fontSize": 12, "color": "#4a4a4a"}, "axisLine": {"show": false}, "axisTick": {"show": false}}, {"type": "category", "data": ["FOMO", "Comparación social", "Agobio por 'visto'", "Likes"], "gridIndex": 1, "inverse": true, "axisLabel": {"show": false}, "axisLine": {"show": false}, "axisTick": {"show": false}}], "visualMap": [{"min": 0, "max": 69, "calculable": false, "show": false, "inRange": {"color": ["#d4edda", "#e8963e", "#e76f51"]}, "seriesIndex": [0]}, {"min": 0, "max": 69, "calculable": false, "show": false, "inRange": {"color": ["#d4edda", "#e8963e", "#e76f51"]}, "seriesIndex": [1]}], "series": [{"name": "Andel cmp", "type": "heatmap", "xAxisIndex": 0, "yAxisIndex": 0, "data": [[0, 0, 31.8], [0, 1, 54.5], [0, 2, 45.5], [0, 3, 45.5], [1, 0, 10.0], [1, 1, 35.0], [1, 2, 30.0], [1, 3, 10.0], [2, 0, 26.5], [2, 1, 25.3], [2, 2, 36.1], [2, 3, 14.5], [3, 0, 37.7], [3, 1, 28.9], [3, 2, 43.0], [3, 3, 20.2], [4, 0, 42.7], [4, 1, 22.9], [4, 2, 41.7], [4, 3, 14.6]], "label": {"show": true, "formatter": function(p) { return p.value[2] > 0 ? p.value[2] + '%' : ''; }, "fontSize": 12, "fontWeight": 600, "fontFamily": "'DM Sans', 'Inter', system-ui, -apple-system, sans-serif"}, "itemStyle": {"borderColor": "#ffffff", "borderWidth": 3, "borderRadius": 6}}, {"name": "Fuenllana cmp", "type": "heatmap", "xAxisIndex": 1, "yAxisIndex": 1, "data": [[0, 0, 17.6], [0, 1, 41.2], [0, 2, 29.4], [0, 3, 11.8], [1, 0, 27.8], [1, 1, 30.6], [1, 2, 33.3], [1, 3, 5.6], [2, 0, 43.9], [2, 1, 31.7], [2, 2, 47.6], [2, 3, 3.7], [3, 0, 66.3], [3, 1, 46.9], [3, 2, 64.4], [3, 3, 21.7], [4, 0, 68.9], [4, 1, 40.0], [4, 2, 55.7], [4, 3, 14.2]], "label": {"show": true, "formatter": function(p) { return p.value[2] > 0 ? p.value[2] + '%' : ''; }, "fontSize": 12, "fontWeight": 600, "fontFamily": "'DM Sans', 'Inter', system-ui, -apple-system, sans-serif"}, "itemStyle": {"borderColor": "#ffffff", "borderWidth": 3, "borderRadius": 6}}], "animationDuration": 800, "animationEasing": "cubicOut"};
      chart._originalOpt = JSON.parse(JSON.stringify(opt));
      chart._originalHeight = '340px';
      chart._compareHeight = '440px';
      chart._compareFn = function(mode) {
        if (mode === 'ambos') {
          chart._el.style.height = chart._compareHeight;
          chart.setOption(chart._compareOpt, {notMerge: true});
        } else {
          chart._el.style.height = chart._originalHeight;
          chart.setOption(chart._originalOpt, {notMerge: true});
        }
        chart.resize();
      };
  })();

  var LABEL_DEFAULT = '#3a3a3a';
  var COLOR_ANDEL = '#060786';
  var COLOR_FUENLLANA = '#c60027';

  
function shouldShow(name, mode) {
  var isTodos = name.indexOf('Todos') === 0;
  var isAndel = name.indexOf('Andel') === 0;
  var isFuenllana = name.indexOf('Fuenllana') === 0;
  if (mode === 'todos') return isTodos;
  if (mode === 'ambos') return isAndel || isFuenllana;
  if (mode === 'Andel') return isAndel;
  if (mode === 'Fuenllana') return isFuenllana;
  return false;
}

function applyFilter(mode) {
  document.querySelectorAll('.school-block').forEach(function(el) {
    var s = el.dataset.school;
    var show = (mode === 'todos' && s === 'todos') ||
               (mode === 'Andel' && s === 'Andel') ||
               (mode === 'Fuenllana' && s === 'Fuenllana') ||
               (mode === 'ambos' && (s === 'Andel' || s === 'Fuenllana'));
    el.style.display = show ? '' : 'none';
  });
  allCharts.forEach(function(chart, idx) {
    var section = chart._el ? chart._el.closest('.chart-section') : null;
    if (chart._howCompare === 'sideBySide' && chart._compareFn) {
      chart._compareFn(mode);
    }
    if (section && section.style.display === 'none') return;
    var content = chart._el ? chart._el.closest('.section-content') : null;
    if (content && !content.classList.contains('expanded')) return;
    if (section) section.style.display = '';
    var insightEl = section ? section.querySelector('.chart-insight') : null;
    if (insightEl) {
      insightEl.classList.toggle('visible', mode === 'ambos');
    }
    var opt = chart.getOption();
    var seriesUpdate = [];
    opt.series.forEach(function(s) {
      var lc = LABEL_DEFAULT;
      if (mode === 'ambos') {
        if (s.name.indexOf('Andel') === 0) lc = COLOR_ANDEL;
        else if (s.name.indexOf('Fuenllana') === 0) lc = COLOR_FUENLLANA;
      }
      seriesUpdate.push({ label: { color: lc } });
    });
    chart.setOption({ series: seriesUpdate });
    var names = opt.series.map(function(s) { return s.name; });
    names.forEach(function(name) {
      chart.dispatchAction({ type: shouldShow(name, mode) ? 'legendSelect' : 'legendUnSelect', name: name });
    });
  });
}

var _currentMode = null;
function setFilter(mode) {
  document.querySelectorAll('.toggle-btn').forEach(function(btn) {
    btn.classList.toggle('active', btn.dataset.filter === mode);
  });
  _currentMode = mode;
  applyFilter(mode);
}


  setFilter('todos');
</script>
</body>
</html>